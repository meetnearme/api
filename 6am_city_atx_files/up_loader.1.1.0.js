var TTDConversionEvents;(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{argsToSdkFunction:()=>ie});var n={merchantId:null,advertiserId:null,enableDebug:!1,enableCookieSyncing:!0,rootUrl:"https://insight.adsrvr.org",dataProcessingOption:null,pixelVersion:"3.0.0"},i={tcfV2ConsentVersion:2,consentRequestHasTimedOut:!1,waitForConsentTimeout:null,consentCheckExists:!1,isGdprApplicable:!1,gdprConsentString:null},r=function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)},o=r({},i),a=r({},n);function s(e,t){if(o.consentRequestHasTimedOut)return d("tcfapi consent request timed out"),void(o.isGdprApplicable=!0);t&&(clearTimeout(o.waitForConsentTimeout),o.isGdprApplicable=e.gdprApplies,o.gdprConsentString=e.tcString)}function c(){o.consentRequestHasTimedOut=!0}function d(e){a.enableDebug&&console.info("TTD Pixel v3: "+e)}var u,l=function(){return l=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},l.apply(this,arguments)},p=null,v={gppString:""},f=l({},n);function g(){u=!0}function h(e){var t;return u?(m("gpp request timed out"),void window.__gpp("removeEventListener",null,e.listenerId)):"signalStatus"===e.eventName&&"ready"===e.data?(v.gppString=null===(t=null==e?void 0:e.pingData)||void 0===t?void 0:t.gppString,clearTimeout(p),window.__gpp("removeEventListener",null,e.listenerId),y(v)):void m("gpp event invalid")}function y(e){var t="&gpp_consent="+e.gppString;return"".concat(t)}function m(e){f.enableDebug&&console.info("TTD Pixel v3: "+e)}function b(e,t,n){!function(e){var t=document.getElementById(e);do{t&&t.parentElement.removeChild(t),t=document.getElementById(e)}while(t)}(t);var i=document.createElement("iframe");function r(){document.body.appendChild(i)}return i.setAttribute("id",t),i.setAttribute("height","0"),i.setAttribute("width","0"),i.setAttribute("style","display:none;"),i.setAttribute("src",e),i.setAttribute("title",n),"complete"===document.readyState?setTimeout(r,0):window.addEventListener?window.addEventListener("load",r):window.attachEvent?window.attachEvent("onload",r):r(),i}function w(){var e=window,t="",n=!1;try{top.location.href&&(t=top.location.href)}catch(e){n=!0}if(n)for(;;)try{if(t=e.document.referrer,window.parent==e)break;e=window.parent}catch(e){break}return-1<t.indexOf("cloudfront.net")&&(t=function(e,t){t=t.replace(/\[/,"\\[").replace(/]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}(t,"url")||t),t}var _=function(){var e,t,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i={isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(t){if(!0===t&&0==--i.readyWait||!0!==t&&!i.isReady){if(!document.body)return setTimeout((function(){return i.ready()}),1);if(i.isReady=!0,!0!==t&&--i.readyWait>0)return;null==e||e.resolveWith(document,[i])}},bindReady:function(){if(!e){if(e=i._Deferred(),"complete"===document.readyState)return setTimeout((function(){return i.ready()}),1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",(function(){return i.ready()}),!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",t),window.attachEvent("onload",i.ready);var n=!1;try{n=null==window.frameElement}catch(e){console.log(e)}document.documentElement.doScroll&&n&&r()}}},_Deferred:function(){var e,t=[],n=!1,r=!1,o={done:function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(!r){var s=void 0;e&&(s=e,e=void 0);for(var c=0,d=n;c<d.length;c++){var u=d[c],l=i.type(u);"array"===l?o.done.apply(o,u):"function"===l&&t.push(u)}s&&o.resolveWith(s[0],s[1])}return o},resolveWith:function(i,a){if(void 0===a&&(a=[]),!r&&!e&&!n){n=!0;try{for(;t.length;){var s=t.shift();null==s||s.apply(i,a)}}finally{e=[i,a],n=!1}}return o},resolve:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.resolveWith(this,e)},isResolved:function(){return!(!n&&!e)},cancel:function(){return r=!0,t=[],o}};return o},type:function(e){return null==e?String(e):n[Object.prototype.toString.call(e)]||"object"}};function r(){if(!i.isReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(r,1)}i.ready()}}return document.addEventListener?t=function(){document.removeEventListener("DOMContentLoaded",t,!1),i.ready()}:document.attachEvent&&(t=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",t),i.ready())}),function(t){i.bindReady(),null==e||e.done(t)}}(),k=function(){return k=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},k.apply(this,arguments)},E=k({},n);function T(e,t){if(E=e,R("Detection started! Library is configured to detect: ",t.detectionSubject),R("Detection event type is ",t.detectionEventType),R("Full config: ",t),"onclick"===t.detectionEventType&&(t.detectionEventType="click"),"onsubmit"===t.detectionEventType||"click"===t.detectionEventType){var n=document.querySelector("body");n&&(D(n,"document",t),t.detectDynamicNodes&&L(n,"document",t))}else R("Detection type not supported! We will not start auto detection.")}function D(e,t,n){var i,r,o;n.scopedTriggers=null!==(i=n.scopedTriggers)&&void 0!==i?i:{},n.scopedValidInputs=null!==(r=n.scopedValidInputs)&&void 0!==r?r:{},n.scopedEventListeners=null!==(o=n.scopedEventListeners)&&void 0!==o?o:{},C(t,n),S(e,t,n)}function S(e,t,n){var i,r,o,a=x(e,t,n),s=x(e,t,n);n.scopedTriggers[t]=null!==(i=n.scopedTriggers[t])&&void 0!==i?i:[],n.scopedValidInputs[t]=null!==(r=n.scopedValidInputs[t])&&void 0!==r?r:[],n.scopedEventListeners[t]=null!==(o=n.scopedEventListeners[t])&&void 0!==o?o:[];for(var c=0,d=s;c<d.length;c++){var u=d[c];u&&u.tagName&&"INPUT"===u.tagName&&n.scopedValidInputs[t].push(u)}R('triggers ["'.concat(t,'"] '),a),R('validInputs ["'.concat(t,'"] '),s),a.forEach((function(e){n.scopedTriggers[t].push(e)}));for(var l=function(e){var i=function(){try{R("Detect event: ",n.detectionEventType,"on element, ",e);for(var t=Object.entries(n.scopedValidInputs).map((function(e){return e[1]})).flatMap((function(e){return e})),i=0,r=t;i<r.length;i++){var o=r[i].value.trim();if(U(o,n)){R("We detected: ",o),I(n);break}}}catch(e){R(e)}};n.scopedEventListeners[t].push(i),e.addEventListener(n.detectionEventType,i,{once:!0,capture:!0})},p=0,v=a;p<v.length;p++)l(v[p]);for(var f,g=(f=e,Array.from(f.querySelectorAll("*")).filter((function(e){return!!e.shadowRoot})).map((function(e){return e.shadowRoot}))),h=0;h<g.length;h++){var y=g[h],m=t+"/shadow_root_"+h;S(y,m,n),L(y,m,n)}}function I(e){R("Detection stopped."),function(e){if(e.detectDynamicNodes){R("Checking for dynamically added elements is turned off.");for(var t=0,n=Object.entries(e.scopedDynamicObservers);t<n.length;t++){var i=n[t][1];i&&i.disconnect(),e.scopedDynamicObservers={}}}}(e),C("all",e)}function C(e,t){if(R("clearing detection hooks (".concat(e,")")),"all"===e){for(var n=0,i=Object.entries(t.scopedTriggers);n<i.length;n++){var r=i[n],o=r[0];if(l=r[1])for(var a=0;a<l.length;a++)l[a].removeEventListener(t.detectionEventType,t.scopedEventListeners[o][a],{capture:!0})}t.scopedTriggers={},t.scopedEventListeners={}}else if(t.scopedTriggers){for(var s=[],c=0,d=Object.entries(t.scopedTriggers);c<d.length;c++){var u=d[c],l=(o=u[0],u[1]);if(o.startsWith(e)){if(l)for(a=0;a<l.length;a++)l[a].removeEventListener(t.detectionEventType,t.scopedEventListeners[o][a],{capture:!0});s.push(o)}}for(var p=0;p<s.length;p++)o=s[p],t.scopedTriggers[o]=[],t.scopedEventListeners[o]=[]}}function L(e,t,n){var i;n.detectDynamicNodes&&(n.scopedDynamicObservers=null!==(i=n.scopedDynamicObservers)&&void 0!==i?i:{},n.scopedDynamicObservers[t]=O((function(){R("Detected dynamically added nodes."),D(e,t,n)}),500),n.scopedDynamicObservers[t].observe(e,{childList:!0,subtree:!0,attributes:!0}))}function x(e,t,n){R('collectElements("'.concat(t,'", ').concat(n.cssSelectors,")"));for(var i=[],r=0,o=n.cssSelectors;r<o.length;r++)if((f=o[r]).length>0){var a=e.querySelectorAll(f);a&&a.forEach((function(e){i.includes(e)||i.push(e)}))}for(var s=window.location.hostname,c=document.getElementsByTagName("iframe"),d=0,u=Array.from(c);d<u.length;d++){var l=u[d];if(P(s,l)&&(l.__upixel_detection={root:e,scopeName:t+"/iframe",config:n},l.removeEventListener("load",j),l.addEventListener("load",j),l.contentDocument))for(var p=0,v=n.cssSelectors;p<v.length;p++){var f;(f=v[p]).length>0&&l.contentDocument.querySelectorAll(f).forEach((function(e){i.includes(e)||i.push(e)}))}}return i}function O(e,t){var n=0,i=null;return new MutationObserver((function(r,o){var a=Date.now(),s=a-n;s>=t?(n=a,e(r,o)):(i&&clearTimeout(i),i=setTimeout((function(){n=Date.now(),e(r,o)}),t-s))}))}function P(e,t){if(!t.src)return!1;try{var n=e===new URL(t.src).hostname;return n&&R("Iframe "+t.src+" can be accessed"),n}catch(e){return R("error: ",e),!1}}function j(e){var t=e.currentTarget;if(t&&t.__upixel_detection)try{D(t.__upixel_detection.root,t.__upixel_detection.scopeName,t.__upixel_detection.config)}catch(e){R(e)}}function U(e,t){return function(e,t){var n=/((([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,}))/i;if(t.detectionSubject.includes("email")&&n.test(e)){var i=function(e){return e.toLowerCase().trim()}(e.match(n)[0]);return R("We detected email: "+i),function(e,t){if(e&&t){var n=new CustomEvent("detected-identifier",{detail:{identifier:e,type:t}});R("Dispatched event with identifier: ",e," and type: ",t),window.dispatchEvent(n)}}(i,"email"),!0}return!1}(e,t)}function R(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];E.enableDebug&&console.info("TTD Pixel v3 - Detection: "+e,t)}O.prototype.observe=function(e,t){this.mutationObserver.observe(e,t)},O.prototype.disconnect=function(){null!=this.nextTimeoutHandle&&clearTimeout(this.nextTimeoutHandle),this.mutationObserver.disconnect()},O.prototype.takeRecords=function(){return this.mutationObserver.takeRecords()},O.prototype.throttledCallback=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Date.now();null!=this.args?this.args=e:this.lastInvocationTime+this.minDelayMs<n?(this.lastInvocationTime=n,this.callback(this.args)):(this.args=e,this.nextTimeoutHandle=setTimeout(function(){this.lastInvocationTime=Date.now(),this.nextTimeoutHandle=null,this.callback.apply(null,this.args),this.args=null}.bind(this),this.minDelayMs))};var A=function(){return A=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},A.apply(this,arguments)},G=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},H=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},N=A({},n);function V(e,t,n){var i=this;N=e,B(t,n),F(t)?n.sdkObj=window.__uid2:q(t)&&(n.sdkObj=window.__euid);try{n.sdkObj.callbacks.push((function(r,o){return G(i,void 0,void 0,(function(){var i,a,s;return H(this,(function(c){switch(c.label){case 0:switch(r){case"SdkLoaded":return[3,1];case"InitCompleted":return[3,2];case"IdentityUpdated":return[3,4]}return[3,5];case 1:try{window.__ttd_m_invoke_once=null!==(i=window.__ttd_m_invoke_once)&&void 0!==i?i:{},window.__ttd_m_invoke_once._uid_init||(window.__ttd_m_invoke_once._uid_init=1,null!==(a=t.baseUrl)&&void 0!==a||(t.baseUrl=n.uidBaseUrl),n.sdkObj.init({baseUrl:t.baseUrl}))}catch(e){J("Non-TTD actor initialized UID SDK, mind the consistency of UID baseUrl.",e)}return[3,5];case 2:return[4,M((function(){return o.identity}),e,t,n)];case 3:return c.sent(),[3,5];case 4:return(null===(s=o.identity)||void 0===s?void 0:s.advertising_token)&&(t.uid_token=o.identity.advertising_token),[3,5];case 5:return[2]}}))}))}))}catch(e){K("Did not setup uid hooks: ",e)}}function W(e,t,n,i,r){void 0===window._uidSdkListenerLock[e]&&(window._uidSdkListenerLock[e]=1,B(t,n),void 0===n.sdkObj&&void 0===window.uidSdkLoaderPromise?window.uidSdkLoaderPromise=new Promise((function(e,t){var o=document.createElement("script");o.setAttribute("defer","true"),o.setAttribute("src",n.uidSdkUrl),o.addEventListener("load",(function(){e(),i()})),o.addEventListener("error",(function(e){t(e),r(e)})),document.body.appendChild(o)})):G(this,void 0,void 0,(function(){return H(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,window.uidSdkLoaderPromise];case 1:return e.sent(),i(),[3,3];case 2:return K("Failed to load uid sdk: ",e.sent()),[3,3];case 3:return[2]}}))})))}function M(e,t,n,i){return G(this,void 0,void 0,(function(){var r,o,a;return H(this,(function(s){switch(s.label){case 0:return s.trys.push([0,8,,9]),(r=e())?[3,3]:n.email?[4,i.sdkObj.setIdentityFromEmail(n.email,n)]:[3,2];case 1:return s.sent(),[3,3];case 2:n.emailHash?i.sdkObj.setIdentityFromEmailHash(n.emailHash,n):n.phone?i.sdkObj.setIdentityFromPhone(n.phone,n):n.phoneHash&&i.sdkObj.setIdentityFromPhoneHash(n.phoneHash,n),s.label=3;case 3:return r?(n.uid_token=r.advertising_token,[3,7]):[3,4];case 4:return window.ttdConversionEvents.activeDetection?[3,7]:(J("in fire or detect no identity"),o=new Promise((function(e){window.addEventListener("detected-identifier",(function(t){e(t.detail.identifier),window.ttdConversionEvents.activeDetection=null})),window.ttdConversionEvents.startDetection=T,window.ttdConversionEvents.startDetection(t,n)})),window.ttdConversionEvents.activeDetection=o,[4,o]);case 5:return a=s.sent(),[4,i.sdkObj.setIdentityFromEmail(a,n)];case 6:return s.sent(),[3,7];case 7:return[3,9];case 8:return K("error setting up cstgOrDetect: ",s.sent()),[3,9];case 9:return[2]}}))}))}function q(e){return"EUID"===(null==e?void 0:e.type)||e.serverPublicKey.includes("EUID")}function F(e){return"UID2"===(null==e?void 0:e.type)||e.serverPublicKey.includes("UID2")}function B(e,t){F(e)?(t.uidSdkUrl="https://js.adsrvr.org/uid2-sdk-4.0.1.js",t.uidBaseUrl="https://global.prod.uidapi.com",t.rtUidTokenName="uid2_token"):q(e)&&(t.uidSdkUrl="https://js.adsrvr.org/euid-sdk-4.0.1.js",t.uidBaseUrl="https://prod.euid.eu",t.rtUidTokenName="euid_token")}function J(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];N.enableDebug&&console.info("TTD Pixel v3 - UnifiedId: "+e,t)}function K(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];N.enableDebug&&console.warn("TTD Pixel v3 - UnifiedId: "+e,t)}function z(){var e={};return document.cookie.split(";").forEach((function(t){if(t){var n=t.split("="),i=n[0].trim(),r=n[1].trim();e[i]=r}})),e}function X(e,t){e&&console.warn("TTD Pixel v3 - GA4: "+t)}var $,Q=function(){return Q=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Q.apply(this,arguments)},Y=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))},Z=function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ee=Q({},n),te={};function ne(){window.ttdConversionEventsLayer.forEach(ie)}function ie(e){var t=e[0],l=e[1];if("init"===t||ee.initComplete){switch(t){case"init":ae("init triggered"),function(e){var t,l,_=e.merchantId,k=e.advertiserId,E=e.enableCookieSyncing,T=e.enableDebug,D=e.rootUrl,S=e.dataProcessingOption,I=e.uidConfig,C=e.pixelIds,L=e.referrerUrl,x=e.ga4MeasurementId;Y(this,void 0,void 0,(function(){var e;return Z(this,(function(O){switch(O.label){case 0:ee.merchantId=_,ee.advertiserId=k,ee.enableCookieSyncing=null!=E?E:n.enableCookieSyncing,ee.enableDebug=null!==(l=null!==(t=null!=T?T:new URL(window.location.href).searchParams.has("upjs_debug"))&&void 0!==t?t:null!=localStorage.getItem("enable-ttd-pixel-debugging"))&&void 0!==l?l:n.enableDebug,ee.rootUrl=D||n.rootUrl,ee.dataProcessingOption=S||n.dataProcessingOption,ee.uidConfig=null!=I?I:void 0,ee.pixelIds=null!=C?C:void 0,ee.ga4MeasurementId=null!=x?x:void 0,ee.referrerUrl=null!=L?L:void 0,e=new Promise((function(e){return setTimeout(e,2e3)})),O.label=1;case 1:return O.trys.push([1,3,4,5]),[4,Promise.race([new Promise((function(e){var t,n,l,_="".concat(ee.rootUrl,"/track/cei"),k=void 0!==ee.merchantId&&null!==ee.merchantId?"merchant_id=".concat(ee.merchantId):"advertiser_id=".concat(ee.advertiserId),E="&cookie_sync=".concat(ee.enableCookieSyncing?1:0),T="".concat(_,"?").concat(k).concat(E,"&upv=").concat(ee.pixelVersion);if(null!=ee.dataProcessingOption&&(T+="&dpop=".concat(ee.dataProcessingOption.policies,"&dpor=").concat(ee.dataProcessingOption.region)),ee.pixelIds&&(T+="&upid=".concat(ee.pixelIds.join(","))),ee.uidConfig){T+="&uidc_present=1",window._uidSdkListenerLock=null!==(t=window._uidSdkListenerLock)&&void 0!==t?t:{};var D=ee.advertiserId+":"+(null!==(l=null===(n=ee.pixelIds)||void 0===n?void 0:n.join(","))&&void 0!==l?l:"");ae("setting up uid config"),W(D,ee.uidConfig,te,(function(){return V(ee,ee.uidConfig,te)}),(function(e){return function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];ee.enableDebug&&console.warn("TTD Pixel v3: "+e,t)}("UID enabled but failed to register hooks: ",e)}))}else window.addEventListener("message",(function(e){!function(e,t,n){var i;try{var r;if(null!==e.origin&&"null"!==e.origin&&new URL(e.origin).hostname.endsWith(".adsrvr.org")&&"string"==typeof e.data){var o=JSON.parse(e.data);!o.type||"string"!=typeof o.type||"UID2"!==o.type&&"EUID"!==o.type||o.advertiserId&&"string"==typeof o.advertiserId&&o.advertiserId==t.advertiserId&&(window._uidSdkListenerLock=null!==(i=window._uidSdkListenerLock)&&void 0!==i?i:{},t.uidConfig=o,W(o.advertiserId+":"+o.pixelId,t.uidConfig,n,(function(){return V(t,t.uidConfig,n)}),(function(e){K("UID enabled but failed to register hooks: ",e)})))}}catch(r){K(r)}}(e,ee,te)}));var S=function(e){if(o=r({},i),a=e,"function"==typeof window.__tcfapi){o.consentCheckExists=!0,o.waitForConsentTimeout=setTimeout(c,1e3),window.__tcfapi("addEventListener",o.tcfV2ConsentVersion,s),d("parse tcf response");var t="&gdpr=".concat(o.isGdprApplicable?1:0),n=null===o.gdprConsentString||void 0===o.gdprConsentString?"":"&gdpr_consent=".concat(o.gdprConsentString);return"".concat(t).concat(n)}d("tcfapi not a function")}(ee);if(null!=S)T+="".concat(S);else{var I=function(e){if(f=e,"function"==typeof window.__gpp)return void 0!==(v=function(){var e=window.__gpp("ping");if("1.0"==e.gppVersion){var t=window.__gpp("getGPPData");v.gppString=null==t?void 0:t.gppString}else v.gppString=null==e?void 0:e.gppString;return v}()).gppString?(m("gpp response already loaded, parse response"),y(v)):(p=setTimeout(g,1e3),u=!1,window.__gpp("addEventListener",h),void 0!==v.gppString?(m("gpp response received, parse response"),y(v)):void 0);m("gpp not a function")}(ee);T+="".concat(null!=I?I:"")}ee.enableDebug&&(T+="&debug=1");var C=ee.referrerUrl||w();T+="&ref=".concat(C);var L="universal_pixel";ee.pixelIds&&(L+="_"+ee.pixelIds.join("_")),ae("trigger GET conversion init call"),b(T,L,"TTD Universal Pixel").onload=function(){return e()}})),e])];case 2:return O.sent(),[3,5];case 3:return se(O.sent()),[3,5];case 4:return ee.initComplete=!0,ne(),[7];case 5:return[2]}}))}))}(l);break;case"event":ae("event fire triggered"),re(l,!0);break;case"optout":ae("optout triggered"),l.isoptout="1",re(l,!1);break;default:throw ae("unexpected event triggered: "+t),"method not implemented"}!function(e){var t=window.ttdConversionEventsLayer.indexOf(e);-1!==t&&window.ttdConversionEventsLayer.splice(t,1)}(e)}}function re(e,t){var n,i,r,a,s,c=null!==(n=e.privacy_settings)&&void 0!==n?n:[],u=function(){var e;if(o.consentCheckExists)return{privacy_type:"GDPR",is_applicable:o.isGdprApplicable,consent_string:null!==(e=o.gdprConsentString)&&void 0!==e?e:""};d("tcfapi consent status check failed")}(),l=function(){if(""!=v.gppString&&null!=v.gppString)return{privacy_type:"GPP",is_applicable:!0,consent_string:v.gppString}}();if(t&&(u?(c=c.filter((function(e){return e.privacy_type!==u.privacy_type})),e.gdpr=u.is_applicable,e.gdpr_consent=u.consent_string):l&&(c=c.filter((function(e){return e.privacy_type!==l.privacy_type})),e.gpp_consent=l.consent_string)),void 0===ee.merchantId||null===ee.merchantId||e.merchant_id?void 0===ee.advertiserId||null===ee.advertiserId||e.adv||(e.adv=ee.advertiserId):e.merchant_id=ee.merchantId,void 0!==ee.ga4MeasurementId){var p=function(e){var t=z()._ga;if(!t||!t.startsWith("GA"))return X(e,"_ga cookie not found or malformed"),null;var n=t.split(".");return 4===n.length?n[2]+"."+n[3]:(X(e,"Unexpected _ga cookie format:"+t),null)}(ee.enableDebug),f=function(e,t){var n=z()["_ga_"+(t=t.startsWith("G-")?t.split("-")[1]:t)];if(!n||!n.startsWith("GS"))return X(e,"_ga_"+t+" cookie not found or malformed"),null;var i=n.split("."),r=i[0].includes("2"),o=i[2];return r?o.split("$")[0].slice(1):o}(ee.enableDebug,ee.ga4MeasurementId);p&&f&&(e.ga_client_id=p,e.ga_session_id=f)}ee.enableDebug&&(e.debug="1"),null!==(i=e.data_processing_option)&&void 0!==i||(e.data_processing_option=ee.dataProcessingOption),null!==(r=e.pixel_ids)&&void 0!==r||(e.pixel_ids=ee.pixelIds),null!==(a=e.referrer_url)&&void 0!==a||(e.referrer_url=w()),(null===(s=ee.uidConfig)||void 0===s?void 0:s.uid_token)&&(F(ee.uidConfig)?e.uid2_token=ee.uidConfig.uid_token:q(ee.uidConfig)&&(e.euid_token=ee.uidConfig.uid_token));var g={data:[Q(Q({},e),{privacy_settings:c})]};ee.enableDebug&&(g.debug="1"),function(e,t){var n=this,i="".concat(ee.rootUrl,"/track/realtimeconversion");return ae("trigger POST realtime conversion event"),new Promise((function(r,o){var a=new XMLHttpRequest;a.withCredentials=!0,a.open("POST",i),a.setRequestHeader("Content-type","application/json"),a.setRequestHeader("eventDataSource","JsSdk"),a.setRequestHeader("eventDataSourceVersion",ee.pixelVersion),a.onload=function(){if(a.status>=200&&a.status<300)r(a.response);else{var n=ue(a);o(a.response),oe(e,t,n)}},a.onerror=function(){return Y(n,void 0,void 0,(function(){var n;return Z(this,(function(i){return n=ue(a),o(a.statusText),oe(e,t,n),[2]}))}))},a.send(JSON.stringify(e))}))}(g,e).catch(se)}function oe(e,t,n){return Y(this,void 0,void 0,(function(){var i,r,o,a;return Z(this,(function(s){var c,d;return i="universal_pixel_realtime_fallback_"+t.pixel_ids.join("_"),ae("trigger GET realtime conversion event fallback"),c=e.data[0],d=Object.entries(c).filter((function(e){var t=e[0],n=e[1];return("string"==typeof n||"number"==typeof n||"boolean"==typeof n||"pixel_ids"===t)&&null!=n&&""!==n})),r=d.map((function(e){var t=e[0],n=e[1];return"".concat(t,"=").concat(n)})).join("&"),o=ee.pixelVersion,a="".concat(ee.rootUrl,"/track/rt"),""!==r&&(a+="?"+r+"&eds=".concat("JsSdkGet")+"&edsv=".concat(o)+"&rt_fallback=1"),""!==n&&(a+="&rt_fbErr=".concat(n)),b(a,i,"TTD Universal Pixel Realtime Fallback"),[2]}))}))}function ae(e){ee.enableDebug&&console.info("TTD Pixel v3: "+e)}function se(e){ee.enableDebug&&console.error("TTD Pixel v3: "+e)}function ce(e,t,n,i,r,o){return Y(this,void 0,void 0,(function(){var a,s,c,d,u;return Z(this,(function(l){if(!e||""==e||!t||t.length<=0)return ae("no advertiser id or pixel id given"),[2];if(a="https://"+new URL(n).hostname,s={advertiserId:e,pixelIds:t,rootUrl:a,uidConfig:r,referrerUrl:o},c={adv:e,pixel_ids:t,referrer_url:o},i)for(d in i)u=i[d],"cookie_sync"===d?s.enableCookieSyncing="1"===u:void 0!==u&&(c[d]="fmt"===d&&"number"==typeof u?u.toString():u),"fmt"!==d||"4"!==u&&4!==u||(s.enableCookieSyncing=!1);return window.ttdConversionEventsLayer.push(["init",s]),setTimeout((function(){var e;!window._uidSdkListenerLock||(null===(e=ee.uidConfig)||void 0===e?void 0:e.uid_token)?window.ttdConversionEventsLayer.push(["event",c]):document.addEventListener("visibilitychange",de)}),1e3),[2]}))}))}function de(e){return Y(this,void 0,void 0,(function(){return Z(this,(function(t){return"hidden"===document.visibilityState&&(re(e,!1),document.removeEventListener("visibilitychange",de)),[2]}))}))}function ue(e){var t,n=null!==(t=e.responseText)&&void 0!==t?t:JSON.parse(e.responseText);return(null==n?void 0:n.Message)?n.Message:0!==e.status||e.responseText?"Status Code ".concat(e.status):"Request never hit server. Possible CSP violation."}window.ttdConversionEventsLayer=window.ttdConversionEventsLayer||[],window.ttdConversionEvents=null!==($=window.ttdConversionEvents)&&void 0!==$?$:{activeDetection:null,startDetection:null},ne(),window.ttdConversionEventsLayer.push=function(e){return Array.prototype.push.call(window.ttdConversionEventsLayer,e),ie(e),this.length},window.ttd_dom_ready=_,window.TTDUniversalPixelApi=function(e){this.init=function(t,n,i,r,o){ce(null!=t?t:void 0,null!=n?n:void 0,null!=i?i:void 0,null!=r?r:void 0,null!=o?o:void 0,null!=e?e:void 0)}},window.ttd_up_api={topLevelUrl:"",set_top_level_url:function(e){this.topLevelUrl=e},init:function(e,t,n,i,r){ce(e,t,n,i,r,this.topLevelUrl)}},TTDConversionEvents=t})();